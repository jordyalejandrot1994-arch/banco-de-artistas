<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Banco de Artistas</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="topbar">
    <h1>Banco de Artistas</h1>
    <nav class="tabs">
      <button data-tab="explorar" class="active">Explorar</button>
      <button data-tab="registrar">Registrar Artista</button>
      <button data-tab="ingresar">Ingresar Artista</button>
      <button data-tab="reservas">Mis Reservas</button>
    </nav>
  </header>

  <main>
    <!-- EXPLORAR -->
    <section id="tab-explorar" class="tab active">
      <div class="filters">
        <input type="text" id="q" placeholder="Buscar por nombre, ciudad o tipo de arte" />
        <select id="f-ciudad"><option value="">Todas las ciudades</option></select>
        <select id="f-tipo"><option value="">Todos los tipos</option></select>
      </div>
      <div id="cards" class="grid"></div>
    </section>

    <!-- REGISTRO ARTISTA -->
    <section id="tab-registrar" class="tab">
      <form id="form-registro" class="card form">
        <h2>Registro de Artista</h2>
        <div class="row">
          <label>Nombre art√≠stico<input name="nombre_artistico" required></label>
          <label>Nombre real<input name="nombre_real" required></label>
        </div>
        <div class="row">
          <label>C√©dula<input name="cedula" required></label>
          <label>Ciudad<input name="ciudad" required></label>
        </div>
        <div class="row">
          <label>Correo<input type="email" name="correo" required></label>
          <label>Celular<input name="celular" required></label>
        </div>
        <div class="row">
          <label>Tipo de arte<select name="tipo_arte" required>
            <option value="Cantante">Cantante</option>
            <option value="DJ">DJ</option>
            <option value="Banda">Banda</option>
            <option value="Danza">Danza</option>
            <option value="Animaci√≥n">Animaci√≥n</option>
          </select></label>
          <label>Video (YouTube) <input name="video" placeholder="https://youtube.com/..." required></label>
        </div>
        <div class="row">
          <label>Foto (URL)<input name="foto" placeholder="https://..." required></label>
          <label>Bio<textarea name="bio" rows="2" placeholder="Descripci√≥n breve" required></textarea></label>
        </div>
        <div class="row">
          <label>Precio 15m<input name="p15" value="50" required></label>
          <label>Precio 30m<input name="p30" value="80" required></label>
          <label>Precio 60m<input name="p60" value="120" required></label>
          <label>Precio 120m<input name="p120" value="220" required></label>
        </div>
        <button class="primary" type="submit">Registrarme</button>
        <p id="msg-registro" class="msg"></p>
      </form>
    </section>

    <!-- INGRESAR ARTISTA (para aceptar solicitudes) -->
    <section id="tab-ingresar" class="tab">
      <form id="form-login-artista" class="card form">
        <h2>Ingresar como Artista</h2>
        <label>C√©dula<input name="cedula" required></label>
        <label>PIN<input name="pin" required></label>
        <button class="primary" type="submit">Ingresar</button>
        <p id="msg-login" class="msg"></p>
      </form>

      <div id="panel-artista" class="card hidden">
        <h3>Solicitudes recibidas</h3>
        <div id="solicitudes-artista" class="stack"></div>
      </div>
    </section>

    <!-- MIS RESERVAS (usuario sube comprobante) -->
    <section id="tab-reservas" class="tab">
      <form id="form-buscar-reserva" class="card form">
        <h2>Mis Reservas</h2>
        <label>Correo con el que hiciste la solicitud<input type="email" name="correo" required></label>
        <button class="primary" type="submit">Buscar</button>
      </form>
      <div id="reservas-usuario" class="stack"></div>
    </section>
  </main>

  <!-- Panel Admin oculto: Ctrl+Shift+A o 3 clics en el t√≠tulo -->
  <aside id="admin" class="sheet hidden">
    <div class="sheet-head">
      <h3>Panel de Administraci√≥n</h3>
      <button id="close-admin">‚úï</button>
    </div>
    <div id="admin-content" class="sheet-body"></div>
  </aside>

  <script src="app.js"></script>
</body>
</html>
```

---

## 2) `styles.css`

```css
:root{ --bg:#0b1220; --panel:#0f172a; --card:#141a2a; --muted:#64748b; --text:#e5e7eb; --accent:#0ea5e9; --accent2:#22d3ee; }
*{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0a1228);color:var(--text);font:15px/1.5 system-ui,Segoe UI,Roboto,Arial}
.topbar{position:sticky;top:0;z-index:10;background:#0c1324;border-bottom:1px solid #0f1b34;padding:12px 16px;display:flex;gap:16px;align-items:center}
.topbar h1{margin:0;font-size:18px}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tabs button{background:#0f172a;color:#cbd5e1;border:1px solid #1e293b;padding:8px 12px;border-radius:12px;cursor:pointer}
.tabs button.active,.tabs button:hover{border-color:var(--accent);color:#fff}
main{max-width:1100px;margin:20px auto;padding:0 16px}
.tab{display:none}
.tab.active{display:block}
.filters{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
.filters input,.filters select{background:#0f172a;border:1px solid #1f2b46;color:var(--text);padding:10px;border-radius:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.card{background:var(--card);border:1px solid #1b2542;border-radius:16px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
.card .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#001016;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700}
button{background:#0f172a;color:#cbd5e1;border:1px solid #1e293b;padding:8px 12px;border-radius:10px;cursor:pointer}
.form .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.form label{display:flex;flex-direction:column;gap:6px;color:#cbd5e1}
.form input,.form textarea,.form select{background:#0f172a;border:1px solid #24314f;color:#e5e7eb;padding:10px;border-radius:12px}
.msg{margin-top:10px;color:#93c5fd}
.stack{display:grid;gap:10px}
.sheet{position:fixed;inset:auto 0 0 0;background:#0b1220;border-top-left-radius:18px;border-top-right-radius:18px;border:1px solid #183054;box-shadow:0 -12px 24px rgba(0,0,0,.35);max-height:88vh;display:flex;flex-direction:column}
.sheet.hidden{display:none}
.sheet-head{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #1a2c4a}
.sheet-body{padding:12px;overflow:auto}
.hidden{display:none}
.video{width:100%;aspect-ratio:16/9;border-radius:12px;border:1px solid #1f2b46}
.badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border:1px solid #25406a;border-radius:999px;color:#bae6fd;background:#0e1a2e}
.small{font-size:12px;color:#9fb3ca}
```

---

## 3) `app.js`

> **Actualiza solo el bloque CONFIG si cambias endpoints o la clave admin.**

```javascript
// ======================= CONFIG =======================
const CONFIG = {
  SHEETDB_ENDPOINT: "https://sheetdb.io/api/v1/jaa331n4u5icl",
  COMMISSION_USER: 0.10,
  COMMISSION_ARTIST: 0.05,
  ADMIN_PASSWORD: "Admin2026",
  BANK: {
    bank: "Banco de Loja",
    account: "2901691001",
    holder: "Jordy Alejandro Torres Quezada",
    id: "1105200057"
  }
};

// ======================= GAS (EMAIL/DRIVE) =======================
const GAS_URL = "https://script.google.com/macros/s/AKfycbwSQeHCvROms5_FkzffVtltXGDFUZ6UB-i2tYzUopwyzjH5CsHkvK70qdRHyTG82IjC/exec";

async function gas(action, payload={}){
  try{
    const r = await fetch(GAS_URL, {
      method: 'POST',
      headers: {'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify({ action, ...payload })
    });
    return await r.json().catch(()=>({ok:false}));
  }catch(e){ console.warn("GAS error:", e); return {ok:false, error: String(e)} }
}

// ======================= HELPERS =======================
const $ = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
const uid = (p="A") => p + Math.random().toString(36).slice(2,8).toUpperCase();
const pin6 = () => (""+Math.floor(100000+Math.random()*900000));

async function sheetGet(){
  const r = await fetch(CONFIG.SHEETDB_ENDPOINT);
  return await r.json();
}
async function sheetPost(row){
  const r = await fetch(CONFIG.SHEETDB_ENDPOINT,{
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ data:[row] })
  });
  return await r.json();
}
async function sheetPatch(id, row){
  const url = `${CONFIG.SHEETDB_ENDPOINT}/id/${encodeURIComponent(id)}`;
  const r = await fetch(url,{ method:'PATCH', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ data: row })});
  return await r.json();
}

// ======================= STATE =======================
let ARTISTAS = [];
let CONTRATOS = []; // en la misma Sheet o en otra (aqu√≠ simulamos en memoria; ajusta si tienes una pesta√±a separate)

// ======================= UI TABS =======================
$$('nav.tabs button').forEach(b=>{
  b.addEventListener('click',()=>{
    $$('nav.tabs button').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    $$('.tab').forEach(t=>t.classList.remove('active'));
    $('#tab-'+b.dataset.tab).classList.add('active');
  })
});

// Admin oculto: Ctrl+Shift+A o 3 clics en el t√≠tulo
let clicks=0; $('header h1').addEventListener('click',()=>{ clicks++; if(clicks>=3){openAdmin()} setTimeout(()=>clicks=0,1200); });
document.addEventListener('keydown',e=>{ if(e.ctrlKey&&e.shiftKey&&e.key.toLowerCase()==='a') openAdmin(); });
$('#close-admin').onclick=()=>$('#admin').classList.add('hidden');

// ======================= CARGA INICIAL =======================
init();

async function init(){
  await cargarArtistas();
  renderFiltros();
  renderCards();
  bindForms();
}

async function cargarArtistas(){
  try{ ARTISTAS = await sheetGet(); }
  catch(e){ console.error(e); ARTISTAS = []; }
}

function renderFiltros(){
  const ciudades = [...new Set(ARTISTAS.map(a=>a.ciudad).filter(Boolean))].sort();
  const tipos = [...new Set(ARTISTAS.map(a=>a.tipo_arte).filter(Boolean))].sort();
  const fc = $('#f-ciudad'), ft = $('#f-tipo');
  ciudades.forEach(c=>fc.insertAdjacentHTML('beforeend',`<option>${c}</option>`));
  tipos.forEach(t=>ft.insertAdjacentHTML('beforeend',`<option>${t}</option>`));
  $('#q, #f-ciudad, #f-tipo');
  ['q','f-ciudad','f-tipo'].forEach(id=>$('#'+id).addEventListener('input',renderCards));
}

function renderCards(){
  const q = $('#q').value.toLowerCase();
  const fc = $('#f-ciudad').value; const ft = $('#f-tipo').value;
  const cont = $('#cards'); cont.innerHTML = '';
  ARTISTAS.filter(a=>{
    const texto = `${a.nombre_artistico} ${a.ciudad} ${a.tipo_arte}`.toLowerCase();
    const okQ = !q || texto.includes(q);
    const okC = !fc || a.ciudad===fc;
    const okT = !ft || a.tipo_arte===ft;
    return okQ && okC && okT && a.deleted!=="TRUE";
  }).forEach(a=>{
    const vId = (a.video||'').includes('watch?v=') ? a.video.split('watch?v=')[1] : (a.video||'').split('/').pop();
    const iframe = vId ? `<iframe class="video" src="https://www.youtube.com/embed/${vId}" allowfullscreen></iframe>` : '';
    const precios = `<span class="badge">15m $${a.p15}</span> <span class="badge">30m $${a.p30}</span> <span class="badge">60m $${a.p60}</span> <span class="badge">120m $${a.p120}</span>`;
    cont.insertAdjacentHTML('beforeend',`
      <article class="card">
        <img src="${a.foto}" alt="${a.nombre_artistico}" style="width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid #1f2b46">
        <h3>${a.nombre_artistico}</h3>
        <div class="small">${a.tipo_arte} ‚Ä¢ ${a.ciudad}</div>
        <p>${a.bio||''}</p>
        ${iframe}
        <div class="actions">
          ${precios}
        </div>
        <div class="actions">
          <button data-id="${a.id}" class="btn-contratar primary">Contratar</button>
        </div>
      </article>`);
  });
  $$('.btn-contratar').forEach(b=>b.onclick=()=>abrirSolicitud(b.dataset.id));
}

// ======================= REGISTRO ARTISTA =======================
function bindForms(){
  $('#form-registro').addEventListener('submit', onRegistro);
  $('#form-login-artista').addEventListener('submit', onLoginArtista);
  $('#form-buscar-reserva').addEventListener('submit', onBuscarReserva);
}

async function onRegistro(e){
  e.preventDefault(); const f = e.target; const data = Object.fromEntries(new FormData(f));
  const id = uid('A'); const pin = pin6();
  const row = { id,
    aprobado:"TRUE", rating:"0", votos:"0",
    foto:data.foto, video:data.video,
    nombre_artistico:data.nombre_artistico, nombre_real:data.nombre_real,
    cedula:data.cedula, ciudad:data.ciudad, correo:data.correo, celular:data.celular,
    tipo_arte:data.tipo_arte, p15:data.p15, p30:data.p30, p60:data.p60, p120:data.p120,
    bio:data.bio, pin, deleted:"FALSE" };
  try{
    await sheetPost(row);
    $('#msg-registro').textContent = 'Registro exitoso. Revisa tu correo para tu PIN.';
    // correo PIN
    await gas('sendPin',{ to:[data.correo], artista:data.nombre_artistico, pin });
    await cargarArtistas(); renderCards(); f.reset();
  }catch(err){ $('#msg-registro').textContent = 'Ocurri√≥ un error en el registro.'; }
}

// ======================= SOLICITUD DE CONTRATACI√ìN =======================
function abrirSolicitud(artistaId){
  const a = ARTISTAS.find(x=>x.id===artistaId); if(!a) return;
  const html = `
  <div class="card">
    <h3>Solicitar a ${a.nombre_artistico}</h3>
    <form id="form-solicitud">
      <label>Tu nombre<input name="usuario_nombre" required></label>
      <label>Tu correo<input type="email" name="usuario_correo" required></label>
      <label>Tu celular<input name="usuario_celular" required></label>
      <label>Ciudad del evento<input name="ciudad_evento" required></label>
      <label>Fecha del evento<input type="date" name="fecha_evento" required></label>
      <label>Duraci√≥n<select name="duracion">
        <option>15</option><option>30</option><option>60</option><option>120</option>
      </select></label>
      <label>Mensaje<textarea name="mensaje" rows="2" placeholder="Detalles del evento..."></textarea></label>
      <div class="actions"><button class="primary" type="submit">Enviar solicitud</button></div>
      <p id="msg-solicitud" class="msg"></p>
    </form>
  </div>`;
  const sheet = $('#admin'); $('#admin-content').innerHTML = html; sheet.classList.remove('hidden');
  $('#form-solicitud').onsubmit = async (e)=>{
    e.preventDefault(); const fd = Object.fromEntries(new FormData(e.target));
    const contrato = {
      id: uid('C'), artista_id:a.id, artista_nombre:a.nombre_artistico, artista_correo:a.correo,
      usuario_nombre:fd.usuario_nombre, usuario_correo:fd.usuario_correo, usuario_celular:fd.usuario_celular,
      ciudad:fd.ciudad_evento, fecha:fd.fecha_evento, duracion:fd.duracion, mensaje:fd.mensaje||'',
      estado:'por confirmar artista', comprobante_url:''
    };
    CONTRATOS.push(contrato); // si tienes pesta√±a "Contrataciones", aqu√≠ har√≠as sheetPost a esa hoja v√≠a un Apps Script proxy
    $('#msg-solicitud').textContent = '‚úÖ Su solicitud fue realizada. Espere confirmaci√≥n del artista en su correo registrado.';
    // correo al artista sin datos personales
    await gas('notifyNewBooking',{
      to:[a.correo],
      artista:a.nombre_artistico,
      fecha:contrato.fecha,
      duracion:contrato.duracion,
      ciudad:contrato.ciudad,
      mensaje:contrato.mensaje
    });
  };
}

// ======================= LOGIN ARTISTA & ACEPTAR =======================
async function onLoginArtista(e){
  e.preventDefault(); const {cedula,pin} = Object.fromEntries(new FormData(e.target));
  const artista = ARTISTAS.find(a=>a.cedula===cedula && a.pin===pin);
  if(!artista){ $('#msg-login').textContent='Datos incorrectos'; return; }
  $('#msg-login').textContent='Listo';
  $('#panel-artista').classList.remove('hidden');
  renderSolicitudesArtista(artista);
}

function renderSolicitudesArtista(artista){
  const cont = $('#solicitudes-artista'); cont.innerHTML='';
  CONTRATOS.filter(c=>c.artista_id===artista.id && c.estado==='por confirmar artista').forEach(c=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div><b>${c.usuario_nombre}</b> solicita show de ${c.duracion} min el ${c.fecha} en ${c.ciudad}</div>
      <div class="small">Mensaje: ${c.mensaje||'-'}</div>
      <div class="actions">
        <button data-id="${c.id}" class="btn-aceptar primary">Aceptar</button>
        <button data-id="${c.id}" class="btn-rechazar">Rechazar</button>
      </div>`;
    cont.appendChild(card);
  });
  $$('.btn-aceptar',cont).forEach(b=>b.onclick=()=>aceptarContrato(b.dataset.id, artista));
  $$('.btn-rechazar',cont).forEach(b=>b.onclick=()=>rechazarContrato(b.dataset.id, artista));
}

async function aceptarContrato(cid, artista){
  const c = CONTRATOS.find(x=>x.id===cid); if(!c) return;
  c.estado = 'por validar pago';
  // correo al usuario con datos de cuenta
  await gas('notifyUserPayment',{
    to:[c.usuario_correo], usuario:c.usuario_nombre, artista:artista.nombre_artistico,
    banco: CONFIG.BANK.bank, cuenta: CONFIG.BANK.account, titular: CONFIG.BANK.holder, cedula: CONFIG.BANK.id
  });
  // correo al admin
  await gas('notifyAdminPayment',{ to:["jordyalejandrot1994@gmail.com"], usuario:c.usuario_nombre, artista:artista.nombre_artistico });
  alert('Solicitud aceptada. El usuario fue notificado para realizar el pago.');
  renderSolicitudesArtista(artista);
}

function rechazarContrato(cid, artista){
  const i = CONTRATOS.findIndex(x=>x.id===cid); if(i>-1) CONTRATOS.splice(i,1);
  renderSolicitudesArtista(artista);
}

// ======================= MIS RESERVAS (SUBIR COMPROBANTE SIMPLIFICADO) =======================
async function onBuscarReserva(e){
  e.preventDefault(); const correo = new FormData(e.target).get('correo');
  const list = CONTRATOS.filter(c=>c.usuario_correo===correo);
  const cont = $('#reservas-usuario'); cont.innerHTML='';
  if(!list.length){ cont.innerHTML = '<div class="card">No se encontraron reservas.</div>'; return; }
  list.forEach(c=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `
      <div><b>${c.artista_nombre}</b> ‚Ä¢ ${c.fecha} ‚Ä¢ ${c.ciudad} ‚Ä¢ ${c.duracion} min</div>
      <div class="small">Estado: ${c.estado}</div>
      ${c.estado==='por validar pago' ? `
        <label>Enlace del comprobante (Drive/Imgur)<input data-id="${c.id}" class="comprobante"></label>
        <div class="actions"><button class="primary" data-id="${c.id}">Enviar comprobante</button></div>
      `:''}
    `;
    cont.appendChild(el);
  });
  $$('#reservas-usuario button').forEach(b=>b.onclick=()=>enviarComprobante(b.dataset.id));
}

async function enviarComprobante(cid){
  const input = $(`input.comprobante[data-id="${cid}"]`);
  const url = input?.value?.trim(); if(!url) return alert('Pega el enlace del comprobante');
  const c = CONTRATOS.find(x=>x.id===cid); if(!c) return;
  c.comprobante_url = url; // aqu√≠ podr√≠as guardar en tu hoja
  alert('Comprobante enviado. El administrador revisar√° y confirmar√°.');
}

// ======================= ADMIN =======================
async function openAdmin(){
  const pass = prompt('Clave de administrador:');
  if(pass!==CONFIG.ADMIN_PASSWORD) return alert('Clave incorrecta');
  $('#admin').classList.remove('hidden');
  renderAdmin();
}

function renderAdmin(){
  const cont = $('#admin-content');
  const pend = CONTRATOS.filter(c=>c.estado==='por validar pago');
  cont.innerHTML = '<h4>Pendientes de validar pago</h4>' + (pend.length? '':'' );
  pend.forEach(c=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `
      <div><b>${c.artista_nombre}</b> ‚Üê‚Üí <b>${c.usuario_nombre}</b></div>
      <div class="small">Fecha: ${c.fecha} ‚Ä¢ Ciudad: ${c.ciudad} ‚Ä¢ Duraci√≥n: ${c.duracion} min</div>
      <div>Comprobante: ${c.comprobante_url ? `<a href="${c.comprobante_url}" target="_blank">Ver</a>` : '‚Äî'}</div>
      <div class="actions">
        <button class="primary" data-id="${c.id}">Marcar como pagado</button>
      </div>`;
    cont.appendChild(el);
  });
  $$('#admin-content button.primary').forEach(b=>b.onclick=()=>confirmarContrato(b.dataset.id));
}

async function confirmarContrato(cid){
  const c = CONTRATOS.find(x=>x.id===cid); if(!c) return;
  c.estado='confirmado';
  // enviar correos con contactos liberados
  const artista = ARTISTAS.find(a=>a.id===c.artista_id);
  await gas('notifyConfirmed',{
    toUser:[c.usuario_correo], toArtist:[artista.correo],
    artista_nombre: artista.nombre_artistico,
    artista_correo: artista.correo, artista_celular: artista.celular,
    usuario_nombre: c.usuario_nombre,
    usuario_correo: c.usuario_correo, usuario_celular: c.usuario_celular
  });
  alert('Contrato confirmado y contactos liberados.');
  renderAdmin();
}
```

---

## 4) `Code.gs` (Google Apps Script)

> Pega este contenido en tu proyecto GAS (el mismo de tu `GAS_URL`). Si tu despliegue es antiguo, vuelve a **Implementar > Implementar como aplicaci√≥n web** y copia la nueva URL si cambia.

```javascript
/**
 * Banco de Artistas ‚Äî Servicio de correos
 * Publicar como WebApp: Ejecutar como t√∫, acceso: Cualquiera con el enlace
 */

function doPost(e){
  try{
    const data = JSON.parse(e.postData.contents || '{}');
    const action = data.action;
    let res = { ok:false };

    switch(action){
      case 'sendPin':
        res = sendPin(data); break;
      case 'notifyNewBooking':
        res = notifyNewBooking(data); break;
      case 'notifyUserPayment':
        res = notifyUserPayment(data); break;
      case 'notifyAdminPayment':
        res = notifyAdminPayment(data); break;
      case 'notifyConfirmed':
        res = notifyConfirmed(data); break;
      default:
        res = { ok:false, error:'Unknown action' };
    }
    return ContentService.createTextOutput(JSON.stringify(res)).setMimeType(ContentService.MimeType.JSON);
  }catch(err){
    return ContentService.createTextOutput(JSON.stringify({ ok:false, error:String(err)})).setMimeType(ContentService.MimeType.JSON);
  }
}

// =============== Helpers ===============
function sendEmail_(to, subject, html){
  try{
    if(!to || !to.length) return { ok:false, error:'No recipients' };
    GmailApp.sendEmail(to.join(','), subject, '', { htmlBody: html });
    return { ok:true };
  }catch(e){ return { ok:false, error: String(e) } }
}

// =============== Plantillas ===============
function tpl(title, body){
  return `
  <div style="font-family:system-ui,Segoe UI,Roboto,Arial;line-height:1.5;color:#0b1220">
    <h2 style="color:#0ea5e9">${title}</h2>
    <div>${body}</div>
    <hr style="border:none;border-top:1px solid #e2e8f0;margin:16px 0" />
    <p style="font-size:12px;color:#64748b">Banco de Artistas ¬∑ Plataforma de contrataci√≥n</p>
  </div>`;
}

// =============== Acciones ===============
function sendPin(d){
  const subject = 'Bienvenido a Banco de Artistas ‚Äî Tu PIN';
  const html = tpl('Registro exitoso üé§', `
    <p>Hola <b>${(d.artista||'')}</b>,</p>
    <p>Tu PIN personal es: <b style="font-size:20px">${(d.pin||'')}</b></p>
    <p>Gu√°rdalo bien, lo necesitar√°s para administrar tus contrataciones.</p>
    <p>Tu perfil ya est√° visible en la plataforma.</p>
  `);
  return sendEmail_(d.to, subject, html);
}

function notifyNewBooking(d){
  const subject = 'Nueva solicitud de contrataci√≥n';
  const html = tpl('Tienes una nueva solicitud üé≠', `
    <p>Has recibido una nueva solicitud de contrataci√≥n.</p>
    <ul>
      <li><b>Fecha:</b> ${safe(d.fecha)}</li>
      <li><b>Duraci√≥n:</b> ${safe(d.duracion)} min</li>
      <li><b>Ciudad:</b> ${safe(d.ciudad)}</li>
      <li><b>Mensaje:</b> ${safe(d.mensaje)}</li>
    </ul>
    <p><i>Los datos personales del contratante se mantienen ocultos hasta que el pago est√© validado.</i></p>
  `);
  return sendEmail_(d.to, subject, html);
}

function notifyUserPayment(d){
  const subject = 'El artista acept√≥ tu solicitud ‚Äî Instrucciones de pago';
  const html = tpl('Tu solicitud fue aceptada ‚úÖ', `
    <p>El artista <b>${safe(d.artista)}</b> ha aceptado tu solicitud.</p>
    <p>Para confirmar el evento, realiza la transferencia o dep√≥sito a la siguiente cuenta:</p>
    <div style="padding:12px;border:1px solid #e2e8f0;border-radius:12px">
      <p>üè¶ <b>${safe(d.banco)}</b><br/>
      Cuenta de Ahorros: <b>${safe(d.cuenta)}</b><br/>
      Titular: <b>${safe(d.titular)}</b><br/>
      C√©dula: <b>${safe(d.cedula)}</b></p>
    </div>
    <p>Luego sube el comprobante en la secci√≥n ‚ÄúMis Reservas‚Äù de la app.</p>
  `);
  return sendEmail_(d.to, subject, html);
}

function notifyAdminPayment(d){
  const subject = 'Contrataci√≥n pendiente de pago';
  const html = tpl('Nueva contrataci√≥n por validar', `
    <p>El usuario <b>${safe(d.usuario)}</b> fue notificado para pagar al artista <b>${safe(d.artista)}</b>.</p>
    <p>Cuando cargue el comprobante, revisa y confirma.</p>
  `);
  return sendEmail_(["jordyalejandrot1994@gmail.com"], subject, html);
}

function notifyConfirmed(d){
  const subjectU = 'Contrato confirmado ‚Äî Contactos liberados';
  const htmlU = tpl('¬°Contrato confirmado! ‚úÖ', `
    <p>Ya puedes coordinar directamente con el artista.</p>
    <ul>
      <li><b>Artista:</b> ${safe(d.artista_nombre)}</li>
      <li><b>Tel√©fono:</b> ${safe(d.artista_celular)}</li>
      <li><b>Correo:</b> ${safe(d.artista_correo)}</li>
    </ul>
  `);
  const resU = sendEmail_(d.toUser, subjectU, htmlU);

  const subjectA = 'Contrato confirmado ‚Äî Datos del contratante';
  const htmlA = tpl('¬°Listo para coordinar! üé∂', `
    <p>El pago fue validado. Datos del contratante:</p>
    <ul>
      <li><b>Nombre:</b> ${safe(d.usuario_nombre)}</li>
      <li><b>Tel√©fono:</b> ${safe(d.usuario_celular)}</li>
      <li><b>Correo:</b> ${safe(d.usuario_correo)}</li>
    </ul>
  `);
  const resA = sendEmail_(d.toArtist, subjectA, htmlA);

  return { ok: resU.ok && resA.ok };
}

function safe(v){ return v==null?'':String(v); }
```

---

## 5) Notas de integraci√≥n

* **Persistencia de contrataciones**: en este ejemplo se mantiene en memoria. Si ya tienes una pesta√±a "Contrataciones" en tu Google Sheet, crea un endpoint Apps Script sencillo para `sheetPost/patch` sobre esa pesta√±a (o duplica el uso de SheetDB con otra tabla). La UI y los correos ya est√°n listos.
* **Subida de comprobantes**: ahora mismo se pega un enlace (Drive/Imgur). Si quieres, puedo activar subida directa a tu Drive desde GAS.
* **Clave Admin**: `Admin2026` (aj√∫stala en `CONFIG.ADMIN_PASSWORD`).
* **Cuenta bancaria**: queda fija en `CONFIG.BANK` y se usa en el correo de pago.

---

## 6) Checklist para publicar

1. Sube `index.html`, `styles.css`, `app.js` al repo (gh-pages).
2. En tu GAS, pega `Code.gs`, **Implementar ‚Üí Implementar como aplicaci√≥n web** (ejecutar como t√∫, acceso cualquiera con el enlace). Si cambia la URL, actualiza `GAS_URL` en `app.js`.
3. Prueba flujos: registro ‚Üí email PIN, contratar ‚Üí email a artista, aceptar (artista) ‚Üí emails a usuario y admin, subir comprobante ‚Üí admin marca pagado ‚Üí emails finales.

---

¬øQuieres que en la siguiente iteraci√≥n guarde las contrataciones en tu misma hoja v√≠a Apps Script (con lectura/escritura real) y habilite subida de archivos a tu Drive? Puedo a√±adir ese mini-API en GAS sin tocar SheetDB de artistas.
