<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Banco de Artistas</title>
  <link rel="stylesheet" href="style-v2.css">
</head>

<body>
  <header id="header-app">
    <h1>Banco de Artistas</h1>
  </header>

  <!-- NAV -->
  <nav class="tabs">
    <button data-tab="explorar" class="active">Explorar</button>
    <button data-tab="registrar">Registrar Artista</button>
    <button data-tab="ingresar">Ingresar Artista</button>
    <button data-tab="reservas">Mis Reservas</button>
  </nav>

  <!-- SECCI√ìN EXPLORAR -->
  <div class="tab active" id="tab-explorar">
    <div class="filters">
      <input id="q" type="text" placeholder="Buscar por nombre, ciudad o tipo...">
      <select id="f-ciudad"><option value="">Todas las ciudades</option></select>
      <select id="f-tipo"><option value="">Todos los tipos</option></select>
    </div>
    <section id="cards"></section>
  </div>

  <!-- SECCI√ìN REGISTRO -->
  <div class="tab" id="tab-registrar">
    <form id="form-registro">
      <label>Nombre art√≠stico<input name="nombre_artistico" required></label>
      <label>Nombre real<input name="nombre_real" required></label>
      <label>C√©dula<input name="cedula" required></label>
      <label>Ciudad<input name="ciudad" required></label>
      <label>Correo<input type="email" name="correo" required></label>
      <label>Celular<input name="celular" required></label>
      <label>Tipo de arte<input name="tipo_arte" required></label>
      <label>Precio 15 min<input name="p15" required></label>
      <label>Precio 30 min<input name="p30" required></label>
      <label>Precio 60 min<input name="p60" required></label>
      <label>Precio 120 min<input name="p120" required></label>
      <label>Biograf√≠a / Descripci√≥n<textarea name="bio"></textarea></label>

      <!-- FOTO -->
      <div class="foto-uploader">
        <label>Foto del artista</label>
        <button type="button" class="secondary" onclick="window.open('https://postimages.org/', '_blank')">
          üì∏ Subir foto en Postimages
        </button>
        <p class="hint">
          1Ô∏è‚É£ Sube tu foto en Postimages.<br>
          2Ô∏è‚É£ Copia el <strong>enlace directo</strong> que termina en <strong>.jpg</strong> o <strong>.png</strong>.<br>
          3Ô∏è‚É£ P√©galo aqu√≠ üëá
        </p>
        <input type="url" id="foto" name="foto" placeholder="Pega el enlace directo" required>
        <p id="alerta-foto" class="alerta"></p>
        <img id="preview-foto" class="preview hidden" alt="Previsualizaci√≥n de la foto">
      </div>

      <label>Video (YouTube)<input name="video" placeholder="https://youtube.com/..."></label>

      <button class="primary" type="submit">Registrar</button>
      <p id="msg-registro" class="msg"></p>
    </form>
  </div>

  <!-- SECCI√ìN INGRESAR ARTISTA -->
  <div class="tab" id="tab-ingresar">
    <form id="form-login-artista">
      <label>C√©dula<input name="cedula" required></label>
      <label>PIN<input name="pin" required></label>
      <button class="primary" type="submit">Ingresar</button>
      <p id="msg-login" class="msg"></p>
    </form>
    <div id="panel-artista" class="hidden">
      <h3>Solicitudes recibidas</h3>
      <div id="solicitudes-artista"></div>
    </div>
  </div>

  <!-- SECCI√ìN RESERVAS -->
  <div class="tab" id="tab-reservas">
    <form id="form-buscar-reserva">
      <label>Correo de tu reserva<input name="correo" type="email" required></label>
      <button class="primary" type="submit">Buscar</button>
    </form>
    <div id="reservas-usuario"></div>
  </div>

  <!-- PANEL DE ADMIN -->
  <div id="admin" class="hidden">
    <div class="admin-header">
      <h2>Panel de Administraci√≥n</h2>
      <button id="close-admin" class="secondary">‚¨ÖÔ∏è Regresar</button>
    </div>
    <div id="admin-content"></div>
  </div>

  <!-- SCRIPTS DE VALIDACI√ìN -->
  <script>
    // =================== VALIDACI√ìN Y PREVISUALIZACI√ìN DE IMAGEN ===================
    const inputFoto = document.getElementById("foto");
    const alertaFoto = document.getElementById("alerta-foto");
    const preview = document.getElementById("preview-foto");

    inputFoto.addEventListener("input", () => {
      const url = inputFoto.value.trim();
      const esValida = /^https:\/\/i\.postimg\.cc\/.*\.(jpg|jpeg|png)$/i.test(url);

      if (esValida) {
        alertaFoto.textContent = "‚úÖ Enlace v√°lido. Imagen lista para subir.";
        alertaFoto.style.color = "#10b981";
        preview.src = url;
        preview.classList.remove("hidden");
      } else if (url.length > 0) {
        alertaFoto.textContent = "‚ö†Ô∏è Enlace no v√°lido. Usa el 'Enlace directo' (.jpg o .png)";
        alertaFoto.style.color = "#ef4444";
        preview.classList.add("hidden");
      } else {
        alertaFoto.textContent = "";
        preview.classList.add("hidden");
      }
    });

    // =================== REGISTRAR ARTISTA ===================
    document.getElementById("form-registro").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = document.getElementById("msg-registro");
      msg.textContent = "";
      const form = e.target;
      const fotoURL = form.foto.value.trim();

      const esValida = /^https:\/\/i\.postimg\.cc\/.*\.(jpg|jpeg|png)$/i.test(fotoURL);
      if (!esValida) {
        msg.textContent = "‚ùå Enlace de foto no v√°lido.";
        msg.style.color = "#ef4444";
        return;
      }

      const artista = {
        nombre_artistico: form.nombre_artistico.value,
        nombre_real: form.nombre_real.value,
        cedula: form.cedula.value,
        ciudad: form.ciudad.value,
        correo: form.correo.value,
        celular: form.celular.value,
        tipo_arte: form.tipo_arte.value,
        p15: form.p15.value,
        p30: form.p30.value,
        p60: form.p60.value,
        p120: form.p120.value,
        bio: form.bio.value,
        foto: fotoURL,
        video: form.video.value,
      };

      try {
        await fetch("https://sheetdb.io/api/v1/jaa331n4u5icl", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data: [artista] }),
        });
        msg.textContent = "‚úÖ Registro exitoso. Espera aprobaci√≥n del administrador.";
        msg.style.color = "#10b981";
        form.reset();
        preview.classList.add("hidden");
        alertaFoto.textContent = "";
      } catch (error) {
        console.error(error);
        msg.textContent = "‚ùå Error al registrar.";
        msg.style.color = "#ef4444";
      }
    });

    // =================== ADMIN ACTIVACI√ìN SECRETA ===================
    let taps = 0;
    const header = document.getElementById("header-app");
    const adminPanel = document.getElementById("admin");
    const closeAdmin = document.getElementById("close-admin");

    header.addEventListener("click", () => {
      taps++;
      if (taps >= 4) abrirAdmin();
      setTimeout(() => (taps = 0), 2000);
    });

    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.altKey && e.key.toLowerCase() === "a") abrirAdmin();
    });

    function abrirAdmin() {
      adminPanel.classList.remove("hidden");
      document.querySelectorAll(".tab, nav").forEach(el => el.classList.add("hidden"));
      cargarAdmin();
    }

    closeAdmin.addEventListener("click", () => {
      adminPanel.classList.add("hidden");
      document.querySelectorAll(".tab, nav").forEach(el => el.classList.remove("hidden"));
    });

    async function cargarAdmin() {
      const res = await fetch("https://sheetdb.io/api/v1/jaa331n4u5icl");
      const data = await res.json();
      const adminContent = document.getElementById("admin-content");

      const artistas = data.filter(a => a.nombre_artistico);
      adminContent.innerHTML = `
        <h3>Artistas registrados (${artistas.length})</h3>
        <div class="admin-list">
          ${artistas.map(a => `
            <div class="admin-item">
              <img src="${a.foto}" alt="${a.nombre_artistico}">
              <div>
                <h4>${a.nombre_artistico}</h4>
                <p><b>Ciudad:</b> ${a.ciudad}</p>
                <p><b>Correo:</b> ${a.correo}</p>
                <p><b>Tipo:</b> ${a.tipo_arte}</p>
                <p><b>Precios:</b> 15min ${a.p15}, 30min ${a.p30}, 60min ${a.p60}</p>
              </div>
            </div>
          `).join("")}
        </div>
      `;
    }
  </script>

  <script src="app-clean.js"></script>
</body>
</html>
