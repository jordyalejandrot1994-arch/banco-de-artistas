<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Banco de Artistas</title>
  <link rel="stylesheet" href="style-v2.css">
</head>

<body>
  <header>
    <h1>Banco de Artistas</h1>
  </header>

  <!-- NAV -->
  <nav class="tabs">
    <button data-tab="explorar" class="active">Explorar</button>
    <button data-tab="registrar">Registrar Artista</button>
    <button data-tab="ingresar">Ingresar Artista</button>
    <button data-tab="reservas">Mis Reservas</button>
  </nav>

  <!-- SECCI√ìN EXPLORAR -->
  <div class="tab active" id="tab-explorar">
    <div class="filters">
      <input id="q" type="text" placeholder="Buscar por nombre, ciudad o tipo...">
      <select id="f-ciudad"><option value="">Todas las ciudades</option></select>
      <select id="f-tipo"><option value="">Todos los tipos</option></select>
    </div>
    <section id="cards"></section>
  </div>

  <!-- SECCI√ìN REGISTRO -->
  <div class="tab" id="tab-registrar">
    <form id="form-registro">
      <label>Nombre art√≠stico<input name="nombre_artistico" required></label>
      <label>Nombre real<input name="nombre_real" required></label>
      <label>C√©dula<input name="cedula" required></label>
      <label>Ciudad<input name="ciudad" required></label>
      <label>Correo<input type="email" name="correo" required></label>
      <label>Celular<input name="celular" required></label>
      <label>Tipo de arte<input name="tipo_arte" required></label>
      <label>Precio 15 min<input name="p15" required></label>
      <label>Precio 30 min<input name="p30" required></label>
      <label>Precio 60 min<input name="p60" required></label>
      <label>Precio 120 min<input name="p120" required></label>
      <label>Biograf√≠a / Descripci√≥n<textarea name="bio"></textarea></label>

      <!-- üñºÔ∏è NUEVA SECCI√ìN POSTIMAGES -->
      <div class="foto-uploader">
        <label>Foto del artista</label>
        <button type="button" class="secondary" onclick="window.open('https://postimages.org/', '_blank')">
          üì∏ Subir foto en Postimages
        </button>
        <p class="hint">
          1Ô∏è‚É£ Se abrir√° una nueva pesta√±a.<br>
          2Ô∏è‚É£ Sube tu foto.<br>
          3Ô∏è‚É£ Copia el <strong>enlace directo (Direct link)</strong> que termina en <strong>.jpg</strong> o <strong>.png</strong>.<br>
          4Ô∏è‚É£ Pega ese enlace aqu√≠ üëá
        </p>
        <input type="url" id="foto" name="foto" placeholder="Pega aqu√≠ el enlace directo de tu imagen" required>
        <p id="alerta-foto" class="alerta"></p>
        <img id="preview-foto" class="preview hidden" alt="Previsualizaci√≥n de la foto">
      </div>

      <label>Video (YouTube)<input name="video" placeholder="https://youtube.com/..."></label>

      <button class="primary" type="submit">Registrar</button>
      <p id="msg-registro" class="msg"></p>
    </form>
  </div>

  <!-- SECCI√ìN INGRESAR ARTISTA -->
  <div class="tab" id="tab-ingresar">
    <form id="form-login-artista">
      <label>C√©dula<input name="cedula" required></label>
      <label>PIN<input name="pin" required></label>
      <button class="primary" type="submit">Ingresar</button>
      <p id="msg-login" class="msg"></p>
    </form>
    <div id="panel-artista" class="hidden">
      <h3>Solicitudes recibidas</h3>
      <div id="solicitudes-artista"></div>
    </div>
  </div>

  <!-- SECCI√ìN RESERVAS -->
  <div class="tab" id="tab-reservas">
    <form id="form-buscar-reserva">
      <label>Correo con el que hiciste la reserva<input name="correo" type="email" required></label>
      <button class="primary" type="submit">Buscar</button>
    </form>
    <div id="reservas-usuario"></div>
  </div>

  <!-- PANEL DE ADMIN -->
  <div id="admin" class="hidden">
    <div id="admin-content"></div>
    <button id="close-admin">Cerrar</button>
  </div>

  <!-- üìú VALIDACI√ìN Y PREVISUALIZACI√ìN DE IMAGEN -->
  <script>
    const inputFoto = document.getElementById("foto");
    const alertaFoto = document.getElementById("alerta-foto");
    const preview = document.getElementById("preview-foto");

    inputFoto.addEventListener("input", () => {
      const url = inputFoto.value.trim();
      const esValida = /^https:\/\/i\.postimg\.cc\/.*\.(jpg|jpeg|png)$/i.test(url);

      if (esValida) {
        alertaFoto.textContent = "‚úÖ Enlace v√°lido. Imagen lista para subir.";
        alertaFoto.style.color = "#10b981";
        preview.src = url;
        preview.classList.remove("hidden");
      } else if (url.length > 0) {
        alertaFoto.textContent = "‚ö†Ô∏è El enlace no es v√°lido. Aseg√∫rate de copiar el 'Enlace directo' que termina en .jpg o .png desde Postimages.";
        alertaFoto.style.color = "#ef4444";
        preview.classList.add("hidden");
      } else {
        alertaFoto.textContent = "";
        preview.classList.add("hidden");
      }
    });

    // ======================= REGISTRAR ARTISTA =======================
    document.getElementById("form-registro").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = document.getElementById("msg-registro");
      msg.textContent = "";

      const form = e.target;
      const fotoURL = form.foto.value.trim();

      const esValida = /^https:\/\/i\.postimg\.cc\/.*\.(jpg|jpeg|png)$/i.test(fotoURL);
      if (!esValida) {
        msg.textContent = "‚ùå No puedes registrar. El enlace de la foto no es v√°lido.";
        msg.style.color = "#ef4444";
        return;
      }

      const artista = {
        nombre_artistico: form.nombre_artistico.value,
        nombre_real: form.nombre_real.value,
        cedula: form.cedula.value,
        ciudad: form.ciudad.value,
        correo: form.correo.value,
        celular: form.celular.value,
        tipo_arte: form.tipo_arte.value,
        p15: form.p15.value,
        p30: form.p30.value,
        p60: form.p60.value,
        p120: form.p120.value,
        bio: form.bio.value,
        foto: fotoURL,
        video: form.video.value
      };

      try {
        await fetch("https://sheetdb.io/api/v1/jaa331n4u5icl", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data: [artista] }),
        });
        msg.textContent = "‚úÖ Artista registrado correctamente.";
        msg.style.color = "#10b981";
        form.reset();
        preview.classList.add("hidden");
        alertaFoto.textContent = "";
      } catch (error) {
        console.error(error);
        msg.textContent = "‚ùå Error al registrar al artista.";
        msg.style.color = "#ef4444";
      }
    });
  </script>

  <script src="app-clean.js"></script>
</body>
</html>
