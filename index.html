<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Banco de Artistas</title>
  <link rel="stylesheet" href="style-v2.css">
</head>

<body>
  <header>
    <h1>Banco de Artistas</h1>
  </header>

  <!-- NAV -->
  <nav class="tabs">
    <button data-tab="explorar" class="active">Explorar</button>
    <button data-tab="registrar">Registrar Artista</button>
    <button data-tab="ingresar">Ingresar Artista</button>
    <button data-tab="reservas">Mis Reservas</button>
  </nav>

  <!-- SECCIÓN EXPLORAR -->
  <div class="tab active" id="tab-explorar">
    <div class="filters">
      <input id="q" type="text" placeholder="Buscar por nombre, ciudad o tipo...">
      <select id="f-ciudad"><option value="">Todas las ciudades</option></select>
      <select id="f-tipo"><option value="">Todos los tipos</option></select>
    </div>
    <section id="cards"></section>
  </div>

  <!-- SECCIÓN REGISTRO -->
  <div class="tab" id="tab-registrar">
    <form id="form-registro">
      <label>Nombre artístico<input name="nombre_artistico" required></label>
      <label>Nombre real<input name="nombre_real" required></label>
      <label>Cédula<input name="cedula" required></label>
      <label>Ciudad<input name="ciudad" required></label>
      <label>Correo<input type="email" name="correo" required></label>
      <label>Celular<input name="celular" required></label>
      <label>Tipo de arte<input name="tipo_arte" required></label>
      <label>Precio 15 min<input name="p15" required></label>
      <label>Precio 30 min<input name="p30" required></label>
      <label>Precio 60 min<input name="p60" required></label>
      <label>Precio 120 min<input name="p120" required></label>
      <label>Biografía / Descripción<textarea name="bio"></textarea></label>
      <label>Foto del artista
        <input type="file" id="fotoFile" name="fotoFile" accept="image/*" capture="environment" required>
      </label>
      <p id="estadoFoto" class="msg"></p>
      <label>Video (YouTube)<input name="video" placeholder="https://youtube.com/..."></label>
      <button class="primary" type="submit">Registrar</button>
      <p id="msg-registro" class="msg"></p>
    </form>
  </div>

  <!-- SECCIÓN INGRESAR ARTISTA -->
  <div class="tab" id="tab-ingresar">
    <form id="form-login-artista">
      <label>Cédula<input name="cedula" required></label>
      <label>PIN<input name="pin" required></label>
      <button class="primary" type="submit">Ingresar</button>
      <p id="msg-login" class="msg"></p>
    </form>
    <div id="panel-artista" class="hidden">
      <h3>Solicitudes recibidas</h3>
      <div id="solicitudes-artista"></div>
    </div>
  </div>

  <!-- SECCIÓN RESERVAS -->
  <div class="tab" id="tab-reservas">
    <form id="form-buscar-reserva">
      <label>Correo con el que hiciste la reserva<input name="correo" type="email" required></label>
      <button class="primary" type="submit">Buscar</button>
    </form>
    <div id="reservas-usuario"></div>
  </div>

  <!-- PANEL DE ADMIN -->
  <div id="admin" class="hidden">
    <div id="admin-content"></div>
    <button id="close-admin">Cerrar</button>
  </div>

  <script>
    // ======================= CONFIG =======================
    const CONFIG = {
      SHEETDB_ENDPOINT: "https://sheetdb.io/api/v1/jaa331n4u5icl",
      IMGUR_CLIENT_ID: "546c25b49708ad3" // público y funcional
    };

    // ======================= FUNCIÓN SUBIR IMAGEN =======================
    async function subirImagenAImgur(file) {
      const estado = document.getElementById("estadoFoto");
      estado.textContent = "Subiendo foto... ⏳";

      const formData = new FormData();
      formData.append("image", file);

      const response = await fetch("https://api.imgur.com/3/image", {
        method: "POST",
        headers: {
          Authorization: `Client-ID ${CONFIG.IMGUR_CLIENT_ID}`,
        },
        body: formData,
      });

      const data = await response.json();

      if (data.success) {
        estado.textContent = "Foto subida correctamente ✅";
        return data.data.link;
      } else {
        estado.textContent = "❌ Error al subir la foto.";
        throw new Error("Error al subir la imagen a Imgur");
      }
    }

    // ======================= REGISTRAR ARTISTA =======================
    document.getElementById("form-registro").addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = document.getElementById("msg-registro");
      const estadoFoto = document.getElementById("estadoFoto");
      msg.textContent = "";
      estadoFoto.textContent = "";

      const form = e.target;
      const file = form.fotoFile.files[0];
      let fotoLink = "";

      try {
        // Subir la imagen a Imgur
        if (file) fotoLink = await subirImagenAImgur(file);

        // Crear objeto artista
        const artista = {
          nombre_artistico: form.nombre_artistico.value,
          nombre_real: form.nombre_real.value,
          cedula: form.cedula.value,
          ciudad: form.ciudad.value,
          correo: form.correo.value,
          celular: form.celular.value,
          tipo_arte: form.tipo_arte.value,
          p15: form.p15.value,
          p30: form.p30.value,
          p60: form.p60.value,
          p120: form.p120.value,
          bio: form.bio.value,
          foto: fotoLink,
          video: form.video.value
        };

        // Enviar datos a SheetDB
        await fetch(CONFIG.SHEETDB_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data: [artista] }),
        });

        msg.textContent = "✅ Artista registrado correctamente.";
        form.reset();
      } catch (err) {
        console.error(err);
        msg.textContent = "❌ Ocurrió un error al registrar al artista.";
      }
    });
  </script>

  <script src="app-clean.js"></script>
</body>
</html>
